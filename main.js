(()=>{"use strict";var e,t=function(e,t,n,o){var r=document.querySelector("#card-template").content.cloneNode(!0),c=r.querySelector(".card"),u=r.querySelector(".card__like-button");c.querySelector(".card__like").textContent=e.likes.length,c.id=e._id,o.then((function(n){if(e.likes.some((function(e){return e._id===n._id}))&&u.classList.add("card__like-button_is-active"),e.owner._id!==n._id){var o=c.querySelector(".card__delete-button");c.removeChild(o)}else c.querySelector(".card__delete-button").addEventListener("click",t)}));var i=c.querySelector(".card__image");return i.src=e.link,i.alt=e.name,i.addEventListener("click",n),c.querySelector(".card__title").textContent=e.name,c},n=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",r),e.addEventListener("click",c)},o=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r),e.removeEventListener("click",c)},r=function(e){var t=document.querySelector(".popup_is-opened");"Escape"===e.key&&o(t)},c=function(e){var t=document.querySelector(".popup_is-opened"),n=t.querySelector(".popup__close");(e.target.contains(t)||e.target===n)&&o(t)},u=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},i=function(e,t){a(e)?(t.classList.add("button_inactive"),t.setAttribute("disabled","disabled")):(t.classList.remove("button_inactive"),t.removeAttribute("disabled"))},a=function(e){return e.some((function(e){return!e.validity.valid}))},l=function(e,t){var n=t.querySelector(e.formSelector),o=Array.from(t.querySelectorAll(e.inputSelector)),r=n.querySelector(e.submitButtonSelector);o.forEach((function(n){u(t,n,e)})),i(o,r)},s="https://nomoreparties.co/v1/wff-cohort-17/",d="87c75715-8e69-4ce9-8fec-d6e54f32a865",p=function(e){return e.ok?Promise.resolve(e.json()):Promise.reject("Ошибка: ".concat(e.status))},f=function(){return fetch("".concat(s,"cards"),{headers:{authorization:d}}).then((function(e){return p(e)}))},_=function(){return fetch("".concat(s,"users/me"),{headers:{authorization:d}}).then((function(e){return p(e)}))},m=function(e,t,n){return fetch("".concat(s,"cards/likes/").concat(e),{method:t,headers:{authorization:d},body:JSON.stringify({profile:n})}).then((function(e){return p(e)}))},y=document.forms["edit-profile"],v=document.forms["new-avatar"],h=document.forms["confirm-delete"],S=document.querySelector(".profile__image"),q=document.forms["new-place"],b=y.querySelector(".popup__input_type_name"),E=v.querySelector(".popup__input_type_url-avatar"),C=y.querySelector(".popup__input_type_description"),L=document.querySelector(".popup_type_edit"),g=document.querySelector(".popup_type_confirm-delete"),k=document.querySelector(".profile__image-update"),x=document.querySelector(".popup_type_new-card"),A=document.querySelector(".popup_type_new-avatar"),T=document.querySelector(".places__list"),w=q.querySelector(".popup__input_type_card-name"),z=q.querySelector(".popup__input_type_url"),P=document.querySelector(".profile__edit-button"),j=document.querySelector(".profile__add-button"),B=document.querySelector(".profile__title"),N=document.querySelector(".profile__description"),O=document.querySelector(".popup_type_image"),D=document.querySelectorAll(".popup__close"),J=document.querySelectorAll(".popup"),H=_().then((function(e){return e})).catch((function(e){return console.log(e)})),M=f(),V={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},I="Сохранить",U=function(e){e.then((function(e){b.value=e.name,C.value=e.about,B.textContent=e.name,N.textContent=e.about,S.src=e.avatar}))},F=function(e){var t=document.querySelector(".popup_is-opened"),n=t.querySelector(".popup__button");e?n.textContent="Сохранение...":(n.textContent="Сохранить",o(t))},G=function(e,t,n){var o=e.submitter;o.textContent="Что-то пошло не так :(",setTimeout((function(){o.textContent=t}),2e3),console.log(n)},K=function(e){var t=e.target.closest(".card");g.querySelector(".popup__button").id=t.id,h.addEventListener("submit",W),n(g)},Q=function(e){!function(e,t,n){var o=e.target.closest(".card"),r=o.querySelector(".card__like");e.target.classList.contains("card__like-button_is-active")?t.then((function(e){n(o.id,"DELETE",e).then((function(e){return r.textContent=e.likes.length})).catch((function(e){return console.log(e)}))})):t.then((function(e){n(o.id,"PUT",e).then((function(e){return r.textContent=e.likes.length})).catch((function(e){return console.log(e)}))})),e.target.classList.toggle("card__like-button_is-active")}(e,H,m)},R=function(e,t){e.querySelector(".card__like-button").addEventListener("click",t)},W=function(e){var t;e.preventDefault(),e.submitter.textContent="Удаление...",(t=e.submitter.id,fetch("".concat(s,"cards/").concat(t),{method:"DELETE",headers:{authorization:d}}).then((function(e){return p(e)}))).then((function(){!function(e){document.getElementById(e).remove()}(e.submitter.id),o(g)})).catch((function(t){return G(e,"Да",t)}))},X=function(e){var t=e.target;document.querySelector(".popup__image").src=t.src,document.querySelector(".popup__caption").textContent=t.alt,n(O)};Promise.all([_,f]).then((function(){U(H),M.then((function(e){e.forEach((function(e){var n=t(e,K,X,H);R(n,Q),T.append(n)}))})).catch((function(e){return console.log(e)}))})),P.addEventListener("click",(function(){b.value=B.textContent,C.value=N.textContent,l(V,L),n(L)})),j.addEventListener("click",(function(){x.querySelector(".popup__form").reset(),l(V,x),n(x)})),k.addEventListener("click",(function(){A.querySelector(".popup__form").reset(),l(V,A),n(A)})),J.forEach((function(e){return e.addEventListener("click",c)})),D.forEach((function(e){return e.addEventListener("click",c)})),y.addEventListener("submit",(function(e){var t=function(e,t){return fetch("".concat(s,"users/me"),{method:"PATCH",headers:{authorization:d,"Content-Type":"application/json"},body:JSON.stringify({name:e.value,about:t.value})}).then((function(e){return p(e)}))}(b,C);F(!0),t.then((function(){U(t),F(!1)})).catch((function(t){return G(e,I,t)}))})),q.addEventListener("submit",(function(e){F(!0),function(e,t){return fetch("".concat(s,"cards"),{method:"POST",headers:{authorization:d,"Content-Type":"application/json"},body:JSON.stringify({name:e.value,link:t.value})}).then((function(e){return p(e)}))}(w,z).then((function(e){var n=t(e,K,X,H);R(n,Q),T.prepend(n),F(!1)})).catch((function(t){return G(e,I,t)}))})),v.addEventListener("submit",(function(e){F(!0),function(e){return fetch("".concat(s,"users/me/avatar"),{method:"PATCH",headers:{authorization:d,"Content-Type":"application/json"},body:JSON.stringify({avatar:e.value})}).then((function(e){return p(e)}))}(E).then((function(e){!function(e){S.src=e.avatar}(e),F(!1)})).catch((function(t){return G(e,I,t)}))})),e=V,Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);i(n,o),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity("Поля могут содержать только латинские и кириллические буквы, знаки дефиса и пробелы."):t.setCustomValidity(""),t.validity.valid?u(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),i(n,o)}))}))}(t,e)}))})();