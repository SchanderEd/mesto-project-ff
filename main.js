(()=>{"use strict";var e,t=function(e,t,n,o){var r=document.querySelector("#card-template").content.cloneNode(!0),c=r.querySelector(".card"),u=r.querySelector(".card__like-button");if(c.querySelector(".card__like").textContent=e.likes.length,c.id=e._id,e.likes.some((function(e){return e._id===o._id}))&&u.classList.add("card__like-button_is-active"),e.owner._id!==o._id){var i=c.querySelector(".card__delete-button");c.removeChild(i)}else c.querySelector(".card__delete-button").addEventListener("click",t);var a=c.querySelector(".card__image");return a.src=e.link,a.alt=e.name,a.addEventListener("click",n),c.querySelector(".card__title").textContent=e.name,c},n=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",r),e.addEventListener("click",c)},o=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r),e.removeEventListener("click",c)},r=function(e){var t=document.querySelector(".popup_is-opened");"Escape"===e.key&&o(t)},c=function(e){var t=document.querySelector(".popup_is-opened"),n=t.querySelector(".popup__close");(e.target.contains(t)||e.target===n)&&o(t)},u=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},i=function(e,t,n){a(e)?(t.classList.add(n.disabledButton),t.setAttribute("disabled","disabled")):(t.classList.remove(n.disabledButton),t.removeAttribute("disabled"))},a=function(e){return e.some((function(e){return!e.validity.valid}))},l=function(e,t){var n=t.querySelector(e.formSelector),o=Array.from(t.querySelectorAll(e.inputSelector)),r=n.querySelector(e.submitButtonSelector);o.forEach((function(n){u(t,n,e)})),i(o,r,e)},s="https://nomoreparties.co/v1/wff-cohort-17/",d="87c75715-8e69-4ce9-8fec-d6e54f32a865",p=function(e){return e.ok?Promise.resolve(e.json()):Promise.reject("Ошибка: ".concat(e.status))},f=function(){return fetch("".concat(s,"cards"),{headers:{authorization:d}}).then((function(e){return p(e)}))},_=function(){return fetch("".concat(s,"users/me"),{headers:{authorization:d}}).then((function(e){return p(e)}))},m=function(e,t,n){return fetch("".concat(s,"cards/likes/").concat(e),{method:t,headers:{authorization:d},body:JSON.stringify({profile:n})}).then((function(e){return p(e)}))},y=function(e,t){var n=document.querySelector(".popup_is-opened"),o=n.querySelector(".popup__button");e?o.textContent="Сохранение...":(o.textContent="Сохранить",t(n))},v=document.forms["edit-profile"],h=document.forms["new-avatar"],S=document.forms["confirm-delete"],q=document.querySelector(".profile__image"),b=document.forms["new-place"],E=v.querySelector(".popup__input_type_name"),C=h.querySelector(".popup__input_type_url-avatar"),L=v.querySelector(".popup__input_type_description"),g=document.querySelector(".popup_type_edit"),k=document.querySelector(".popup_type_confirm-delete"),x=document.querySelector(".profile__image-update"),A=document.querySelector(".popup_type_new-card"),T=document.querySelector(".popup_type_new-avatar"),w=document.querySelector(".places__list"),B=b.querySelector(".popup__input_type_card-name"),z=b.querySelector(".popup__input_type_url"),P=document.querySelector(".popup__image"),j=document.querySelector(".popup__caption"),N=document.querySelector(".profile__edit-button"),O=document.querySelector(".profile__add-button"),D=document.querySelector(".profile__title"),J=document.querySelector(".profile__description"),H=document.querySelector(".popup_type_image"),M=document.querySelectorAll(".popup__close"),V=document.querySelectorAll(".popup"),I=_().then((function(e){return e})).catch((function(e){return console.log(e)})),U=f(),F={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active",disabledButton:"button_inactive"},G="Сохранить",K=function(e){e.then((function(e){E.value=e.name,L.value=e.about,D.textContent=e.name,J.textContent=e.about,q.src=e.avatar}))},Q=function(e,t,n){var o=e.submitter;o.textContent="Что-то пошло не так :(",setTimeout((function(){o.textContent=t}),2e3),console.log(n)},R=function(e){var t=e.target.closest(".card");k.querySelector(".popup__button").id=t.id,S.addEventListener("submit",Y),n(k)},W=function(e){!function(e,t,n){var o=e.target.closest(".card"),r=o.querySelector(".card__like");e.target.classList.contains("card__like-button_is-active")?t.then((function(e){n(o.id,"DELETE",e).then((function(e){return r.textContent=e.likes.length})).catch((function(e){return console.log(e)}))})):t.then((function(e){n(o.id,"PUT",e).then((function(e){return r.textContent=e.likes.length})).catch((function(e){return console.log(e)}))})),e.target.classList.toggle("card__like-button_is-active")}(e,I,m)},X=function(e,t){e.querySelector(".card__like-button").addEventListener("click",t)},Y=function(e){var t;e.preventDefault(),e.submitter.textContent="Удаление...",(t=e.submitter.id,fetch("".concat(s,"cards/").concat(t),{method:"DELETE",headers:{authorization:d}}).then((function(e){return p(e)}))).then((function(){!function(e){document.getElementById(e).remove()}(e.submitter.id),o(k)})).catch((function(t){return Q(e,"Да",t)}))},Z=function(e){var t=e.target;P.src=t.src,P.alt=t.alt,j.textContent=t.alt,n(H)};Promise.all([_,f]).then((function(){K(I),U.then((function(e){I.then((function(n){e.forEach((function(e){var o=t(e,R,Z,n);X(o,W),w.append(o)}))}))})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)})),N.addEventListener("click",(function(){E.value=D.textContent,L.value=J.textContent,l(F,g),n(g)})),O.addEventListener("click",(function(){A.querySelector(".popup__form").reset(),l(F,A),n(A)})),x.addEventListener("click",(function(){T.querySelector(".popup__form").reset(),l(F,T),n(T)})),V.forEach((function(e){return e.addEventListener("click",c)})),M.forEach((function(e){return e.addEventListener("click",c)})),v.addEventListener("submit",(function(e){var t=function(e,t){return fetch("".concat(s,"users/me"),{method:"PATCH",headers:{authorization:d,"Content-Type":"application/json"},body:JSON.stringify({name:e.value,about:t.value})}).then((function(e){return p(e)}))}(E,L);y(!0),t.then((function(){K(t),y(!1,o)})).catch((function(t){return Q(e,G,t)}))})),b.addEventListener("submit",(function(e){y(!0),function(e,t){return fetch("".concat(s,"cards"),{method:"POST",headers:{authorization:d,"Content-Type":"application/json"},body:JSON.stringify({name:e.value,link:t.value})}).then((function(e){return p(e)}))}(B,z).then((function(e){I.then((function(n){var r=t(e,R,Z,n);X(r,W),w.prepend(r),y(!1,o)}))})).catch((function(t){return Q(e,G,t)}))})),h.addEventListener("submit",(function(e){y(!0),function(e){return fetch("".concat(s,"users/me/avatar"),{method:"PATCH",headers:{authorization:d,"Content-Type":"application/json"},body:JSON.stringify({avatar:e.value})}).then((function(e){return p(e)}))}(C).then((function(e){!function(e){q.src=e.avatar}(e),y(!1,o)})).catch((function(t){return Q(e,G,t)}))})),e=F,Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);i(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity("Поля могут содержать только латинские и кириллические буквы, знаки дефиса и пробелы."):t.setCustomValidity(""),t.validity.valid?u(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),i(n,o,t)}))}))}(t,e)}))})();